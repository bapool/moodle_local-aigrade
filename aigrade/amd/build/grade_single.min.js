/**
 * AMD module for AI Grade single submission button
 *
 * @module     local_aigrade/grade_single
 * @copyright  2025 Brian A. Pool, National Trail Local Schools
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_aigrade/grade_single",["jquery"],(function($){return{init:function(buttonUrl,buttonText,sesskey){var insertButton=function(){if($(".aigrade-single-button").length>0)return!0;var button=$("<button>").attr("type","button").addClass("btn btn-primary aigrade-single-button").text(buttonText).data("force-regrade",!1).on("click",(function(){var btn=$(this),originalText=btn.text(),forceRegrade=btn.data("force-regrade");btn.prop("disabled",!0).text("Grading...");var currentUserid=new URLSearchParams(window.location.search).get("userid"),url=buttonUrl.replace("userid=0","userid="+currentUserid)+"&action=grade&sesskey="+sesskey;forceRegrade&&(url+="&force_regrade=1"),$.ajax({url:url,method:"POST",dataType:"json",success:function(response){if(response.success)window.location.reload();else if(response.already_graded)btn.prop("disabled",!1),btn.text("Regrade with AI"),btn.removeClass("btn-primary").addClass("btn-warning"),btn.data("force-regrade",!0),confirm("This submission is already graded. Do you want to regrade it with AI?")&&btn.click();else{var errorMsg=response.error||"Unknown error occurred";alert("Error: "+errorMsg),btn.prop("disabled",!1).text(originalText)}},error:function(xhr,status,error){alert("Error communicating with server: "+error),btn.prop("disabled",!1).text(originalText)}})})),container=$("<div>").addClass("local_aigrade-button-container").append(button),inserted=!1,gradeInput=$('input[name="grade"]');if(gradeInput.length){var gradeRow=gradeInput.closest(".row, .fitem");gradeRow.length&&(gradeRow.after(container),inserted=!0)}if(!inserted){var feedbackSection=$('div[id*="fitem_id_assignfeedbackcomments"]');feedbackSection.length&&(feedbackSection.before(container),inserted=!0)}if(!inserted){var gradePanel=$('[data-region="grade-panel"]');gradePanel.length&&(gradePanel.prepend(container),inserted=!0)}if(!inserted){var mainContent=$('#region-main-box, #region-main, [role="main"]').first();mainContent.length&&(mainContent.prepend(container),inserted=!0)}return inserted};setTimeout(insertButton,100),$(document).ready((function(){setTimeout(insertButton,100)})),$(window).on("load",(function(){setTimeout(insertButton,200)})),new MutationObserver((function(){insertButton()})).observe(document.body,{childList:!0,subtree:!0}),$(document).ajaxComplete((function(){setTimeout(insertButton,100)}));var checkCount=0,checkInterval=setInterval((function(){checkCount++,(insertButton()||checkCount>=20)&&clearInterval(checkInterval)}),500)}}}));

//# sourceMappingURL=grade_single.min.js.map