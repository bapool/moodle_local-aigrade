/**
 * AMD module for AI Grade single submission button
 *
 * @module     local_aigrade/grade_single
 * @copyright  2025 Brian A. Pool, National Trail Local Schools
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_aigrade/grade_single",["jquery","core/ajax","core/str"],(function($,Ajax,Str){return{init:function(cmid,userid,buttonText){var insertButton=function(){if($(".aigrade-single-button").length>0)return!0;var button=$("<button>").attr("type","button").addClass("btn btn-primary aigrade-single-button").text(buttonText).on("click",(function(){var btn=$(this),originalText=btn.text();Str.get_strings([{key:"grading_single_in_progress",component:"local_aigrade"},{key:"error_with_message",component:"local_aigrade"},{key:"error_unknown",component:"local_aigrade"},{key:"error_server_communication",component:"local_aigrade"}]).done((function(strings){btn.prop("disabled",!0).text(strings[0]),Ajax.call([{methodname:"local_aigrade_grade_single",args:{cmid:cmid,userid:userid}}])[0].done((function(response){if(response.success)window.location.reload();else{var errorMsg=response.error||strings[2];alert(strings[1].replace("{$a}",errorMsg)),btn.prop("disabled",!1).text(originalText)}})).fail((function(error){var errorMsg=error.message||strings[2];alert(strings[3].replace("{$a}",errorMsg)),btn.prop("disabled",!1).text(originalText)}))})).fail((function(){btn.prop("disabled",!0).text("Grading..."),Ajax.call([{methodname:"local_aigrade_grade_single",args:{cmid:cmid,userid:userid}}])[0].done((function(response){if(response.success)window.location.reload();else{var errorMsg=response.error||"Unknown error occurred";alert("Error: "+errorMsg),btn.prop("disabled",!1).text(originalText)}})).fail((function(error){alert("Error communicating with server: "+(error.message||"Unknown error")),btn.prop("disabled",!1).text(originalText)}))}))})),container=$("<div>").addClass("local_aigrade-button-container").append(button),inserted=!1,gradeInput=$('input[name="grade"]');if(gradeInput.length){var gradeRow=gradeInput.closest(".row, .fitem");gradeRow.length&&(gradeRow.after(container),inserted=!0)}if(!inserted){var feedbackSection=$('div[id*="fitem_id_assignfeedbackcomments"]');feedbackSection.length&&(feedbackSection.before(container),inserted=!0)}if(!inserted){var gradePanel=$('[data-region="grade-panel"]');gradePanel.length&&(gradePanel.prepend(container),inserted=!0)}if(!inserted){var mainContent=$('#region-main-box, #region-main, [role="main"]').first();mainContent.length&&(mainContent.prepend(container),inserted=!0)}return inserted};setTimeout(insertButton,100),$(document).ready((function(){setTimeout(insertButton,100)})),$(window).on("load",(function(){setTimeout(insertButton,200)})),new MutationObserver((function(){insertButton()})).observe(document.body,{childList:!0,subtree:!0}),$(document).ajaxComplete((function(){setTimeout(insertButton,100)}));var checkCount=0,checkInterval=setInterval((function(){checkCount++,(insertButton()||checkCount>=20)&&clearInterval(checkInterval)}),500)}}}));

//# sourceMappingURL=grade_single.min.js.map