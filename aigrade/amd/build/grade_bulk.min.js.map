{"version":3,"file":"grade_bulk.min.js","sources":["../src/grade_bulk.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for AI Grade bulk grading button\n *\n * @module     local_aigrade/grade_bulk\n * @copyright  2025 Brian A. Pool, National Trail Local Schools\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        /**\n         * Initialize the grade bulk button\n         * @param {string} buttonUrl The URL for the AJAX request\n         * @param {string} buttonText The text to display on the button\n         * @param {string} sesskey The session key\n         */\n        init: function(buttonUrl, buttonText, sesskey) {\n            var insertButton = function() {\n                // Don't insert if button already exists\n                if ($('.aigrade-button-injected').length > 0) {\n                    return true;\n                }\n\n                // Create the button\n                var button = $('<button>')\n                    .attr('type', 'button')\n                    .addClass('btn btn-primary aigrade-button-injected')\n                    .text(buttonText)\n                    .on('click', function() {\n                        var btn = $(this);\n                        var originalText = btn.text();\n\n                        if (!confirm('Grade all ungraded submissions with AI? This may take a few moments.')) {\n                            return;\n                        }\n\n                        btn.prop('disabled', true).text('Grading all submissions...');\n\n                        $.ajax({\n                            url: buttonUrl + '&action=grade&sesskey=' + sesskey,\n                            method: 'POST',\n                            dataType: 'json',\n                            success: function(response) {\n                                if (response.success) {\n                                    Notification.addNotification({\n                                        message: 'Successfully graded ' + response.count + ' submission(s).',\n                                        type: 'success'\n                                    });\n                                    window.location.reload();\n                                } else {\n                                    Notification.addNotification({\n                                        message: 'Error: ' + (response.error || 'Unknown error occurred'),\n                                        type: 'error'\n                                    });\n                                    btn.prop('disabled', false).text(originalText);\n                                }\n                            },\n                            error: function(xhr, status, error) {\n                                Notification.addNotification({\n                                    message: 'Error communicating with server: ' + error,\n                                    type: 'error'\n                                });\n                                btn.prop('disabled', false).text(originalText);\n                            }\n                        });\n                    });\n\n                var container = $('<div>')\n                    .addClass('mb-3')\n                    .append(button);\n\n                // Insert before the submissions table\n                var submissionsTable = $('table.flexible, table.generaltable').first();\n                if (submissionsTable.length) {\n                    submissionsTable.before(container);\n                    return true;\n                }\n\n                // Fallback: insert at top of main content\n                var mainContent = $('#region-main').first();\n                if (mainContent.length) {\n                    mainContent.prepend(container);\n                    return true;\n                }\n\n                return false;\n            };\n\n            // Try to insert button immediately\n            setTimeout(insertButton, 100);\n\n            // Try after DOM ready\n            $(document).ready(function() {\n                setTimeout(insertButton, 100);\n            });\n\n            // Try after window load\n            $(window).on('load', function() {\n                setTimeout(insertButton, 200);\n            });\n\n            // Periodic checking as fallback\n            var checkCount = 0;\n            var checkInterval = setInterval(function() {\n                checkCount++;\n                if (insertButton() || checkCount >= 20) {\n                    clearInterval(checkInterval);\n                }\n            }, 500);\n        }\n    };\n});\n"],"names":["define","$","Notification","init","buttonUrl","buttonText","sesskey","insertButton","length","button","attr","addClass","text","on","btn","this","originalText","confirm","prop","ajax","url","method","dataType","success","response","addNotification","message","count","type","window","location","reload","error","xhr","status","container","append","submissionsTable","first","before","mainContent","prepend","setTimeout","document","ready","checkCount","checkInterval","setInterval","clearInterval"],"mappings":";;;;;;;AAuBAA,kCAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CAOHC,KAAM,SAASC,UAAWC,WAAYC,aAC9BC,aAAe,cAEXN,EAAE,4BAA4BO,OAAS,SAChC,MAIPC,OAASR,EAAE,YACVS,KAAK,OAAQ,UACbC,SAAS,2CACTC,KAAKP,YACLQ,GAAG,SAAS,eACLC,IAAMb,EAAEc,MACRC,aAAeF,IAAIF,OAElBK,QAAQ,0EAIbH,IAAII,KAAK,YAAY,GAAMN,KAAK,8BAEhCX,EAAEkB,KAAK,CACHC,IAAKhB,UAAY,yBAA2BE,QAC5Ce,OAAQ,OACRC,SAAU,OACVC,QAAS,SAASC,UACVA,SAASD,SACTrB,aAAauB,gBAAgB,CACzBC,QAAS,uBAAyBF,SAASG,MAAQ,kBACnDC,KAAM,YAEVC,OAAOC,SAASC,WAEhB7B,aAAauB,gBAAgB,CACzBC,QAAS,WAAaF,SAASQ,OAAS,0BACxCJ,KAAM,UAEVd,IAAII,KAAK,YAAY,GAAON,KAAKI,gBAGzCgB,MAAO,SAASC,IAAKC,OAAQF,OACzB9B,aAAauB,gBAAgB,CACzBC,QAAS,oCAAsCM,MAC/CJ,KAAM,UAEVd,IAAII,KAAK,YAAY,GAAON,KAAKI,qBAK7CmB,UAAYlC,EAAE,SACbU,SAAS,QACTyB,OAAO3B,QAGR4B,iBAAmBpC,EAAE,sCAAsCqC,WAC3DD,iBAAiB7B,cACjB6B,iBAAiBE,OAAOJ,YACjB,MAIPK,YAAcvC,EAAE,gBAAgBqC,gBAChCE,YAAYhC,SACZgC,YAAYC,QAAQN,YACb,IAOfO,WAAWnC,aAAc,KAGzBN,EAAE0C,UAAUC,OAAM,WACdF,WAAWnC,aAAc,QAI7BN,EAAE4B,QAAQhB,GAAG,QAAQ,WACjB6B,WAAWnC,aAAc,YAIzBsC,WAAa,EACbC,cAAgBC,aAAY,WAC5BF,cACItC,gBAAkBsC,YAAc,KAChCG,cAAcF,iBAEnB"}