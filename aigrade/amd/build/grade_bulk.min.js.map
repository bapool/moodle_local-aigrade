{"version":3,"file":"grade_bulk.min.js","sources":["../src/grade_bulk.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for AI Grade bulk grading button\n *\n * @module     local_aigrade/grade_bulk\n * @copyright  2025 Brian A. Pool, National Trail Local Schools\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/notification'], function($, Notification) {\n\n    return {\n        /**\n         * Initialize the grade bulk button\n         * @param {string} buttonUrl The URL for the AJAX request\n         * @param {string} buttonText The text to display on the button\n         * @param {string} sesskey The session key\n         */\n        init: function(buttonUrl, buttonText, sesskey) {\n            var insertButton = function() {\n                // Don't insert if button already exists\n                if ($('.aigrade-button-injected').length > 0) {\n                    return true;\n                }\n\n                // Create the button\n                var button = $('<button>')\n                    .attr('type', 'button')\n                    .addClass('btn btn-primary aigrade-button-injected')\n                    .text(buttonText)\n                    .on('click', function() {\n                        var btn = $(this);\n                        var originalText = btn.text();\n\n                        // Get group parameter from current page URL\n                        var urlParams = new URLSearchParams(window.location.search);\n                        var groupParam = urlParams.get('group') || '';\n                        var groupQuery = groupParam ? '&group=' + groupParam : '';\n\n                        if (!confirm('Grade all ungraded submissions with AI? This may take a few moments.')) {\n                            return;\n                        }\n\n                        btn.prop('disabled', true).text('Grading all submissions...');\n\n                        $.ajax({\n                            url: buttonUrl + '&action=grade&sesskey=' + sesskey + groupQuery,\n                            method: 'POST',\n                            dataType: 'json',\n                            success: function(response) {\n                                if (response.success) {\n                                    Notification.addNotification({\n                                        message: 'Successfully graded ' + response.count + ' submission(s).',\n                                        type: 'success'\n                                    });\n                                    window.location.reload();\n                                } else {\n                                    Notification.addNotification({\n                                        message: 'Error: ' + (response.error || 'Unknown error occurred'),\n                                        type: 'error'\n                                    });\n                                    btn.prop('disabled', false).text(originalText);\n                                }\n                            },\n                            error: function(xhr, status, error) {\n                                Notification.addNotification({\n                                    message: 'Error communicating with server: ' + error,\n                                    type: 'error'\n                                });\n                                btn.prop('disabled', false).text(originalText);\n                            }\n                        });\n                    });\n\n                var container = $('<div>')\n                    .addClass('mb-3')\n                    .append(button);\n\n                // Insert before the submissions table\n                var submissionsTable = $('table.flexible, table.generaltable').first();\n                if (submissionsTable.length) {\n                    submissionsTable.before(container);\n                    return true;\n                }\n\n                // Fallback: insert at top of main content\n                var mainContent = $('#region-main').first();\n                if (mainContent.length) {\n                    mainContent.prepend(container);\n                    return true;\n                }\n\n                return false;\n            };\n\n            // Try to insert button immediately\n            setTimeout(insertButton, 100);\n\n            // Try after DOM ready\n            $(document).ready(function() {\n                setTimeout(insertButton, 100);\n            });\n\n            // Try after window load\n            $(window).on('load', function() {\n                setTimeout(insertButton, 200);\n            });\n\n            // Periodic checking as fallback\n            var checkCount = 0;\n            var checkInterval = setInterval(function() {\n                checkCount++;\n                if (insertButton() || checkCount >= 20) {\n                    clearInterval(checkInterval);\n                }\n            }, 500);\n        }\n    };\n});\n"],"names":["define","$","Notification","init","buttonUrl","buttonText","sesskey","insertButton","length","button","attr","addClass","text","on","btn","this","originalText","groupParam","URLSearchParams","window","location","search","get","groupQuery","confirm","prop","ajax","url","method","dataType","success","response","addNotification","message","count","type","reload","error","xhr","status","container","append","submissionsTable","first","before","mainContent","prepend","setTimeout","document","ready","checkCount","checkInterval","setInterval","clearInterval"],"mappings":";;;;;;;AAuBAA,kCAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,oBAEzC,CAOHC,KAAM,SAASC,UAAWC,WAAYC,aAC9BC,aAAe,cAEXN,EAAE,4BAA4BO,OAAS,SAChC,MAIPC,OAASR,EAAE,YACVS,KAAK,OAAQ,UACbC,SAAS,2CACTC,KAAKP,YACLQ,GAAG,SAAS,eACLC,IAAMb,EAAEc,MACRC,aAAeF,IAAIF,OAInBK,WADY,IAAIC,gBAAgBC,OAAOC,SAASC,QACzBC,IAAI,UAAY,GACvCC,WAAaN,WAAa,UAAYA,WAAa,GAElDO,QAAQ,0EAIbV,IAAIW,KAAK,YAAY,GAAMb,KAAK,8BAEhCX,EAAEyB,KAAK,CACHC,IAAKvB,UAAY,yBAA2BE,QAAUiB,WACtDK,OAAQ,OACRC,SAAU,OACVC,QAAS,SAASC,UACVA,SAASD,SACT5B,aAAa8B,gBAAgB,CACzBC,QAAS,uBAAyBF,SAASG,MAAQ,kBACnDC,KAAM,YAEVhB,OAAOC,SAASgB,WAEhBlC,aAAa8B,gBAAgB,CACzBC,QAAS,WAAaF,SAASM,OAAS,0BACxCF,KAAM,UAEVrB,IAAIW,KAAK,YAAY,GAAOb,KAAKI,gBAGzCqB,MAAO,SAASC,IAAKC,OAAQF,OACzBnC,aAAa8B,gBAAgB,CACzBC,QAAS,oCAAsCI,MAC/CF,KAAM,UAEVrB,IAAIW,KAAK,YAAY,GAAOb,KAAKI,qBAK7CwB,UAAYvC,EAAE,SACbU,SAAS,QACT8B,OAAOhC,QAGRiC,iBAAmBzC,EAAE,sCAAsC0C,WAC3DD,iBAAiBlC,cACjBkC,iBAAiBE,OAAOJ,YACjB,MAIPK,YAAc5C,EAAE,gBAAgB0C,gBAChCE,YAAYrC,SACZqC,YAAYC,QAAQN,YACb,IAOfO,WAAWxC,aAAc,KAGzBN,EAAE+C,UAAUC,OAAM,WACdF,WAAWxC,aAAc,QAI7BN,EAAEkB,QAAQN,GAAG,QAAQ,WACjBkC,WAAWxC,aAAc,YAIzB2C,WAAa,EACbC,cAAgBC,aAAY,WAC5BF,cACI3C,gBAAkB2C,YAAc,KAChCG,cAAcF,iBAEnB"}