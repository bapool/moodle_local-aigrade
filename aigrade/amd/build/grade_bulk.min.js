/**
 * AMD module for AI Grade bulk grading button
 *
 * @module     local_aigrade/grade_bulk
 * @copyright  2025 Brian A. Pool, National Trail Local Schools
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_aigrade/grade_bulk",["jquery","core/ajax","core/notification","core/str"],(function($,Ajax,Notification,Str){return{init:function(cmid,buttonText){var insertButton=function(){if($(".aigrade-button-injected").length>0)return!0;var button=$("<button>").attr("type","button").addClass("btn btn-primary aigrade-button-injected").text(buttonText).on("click",(function(){var btn=$(this),originalText=btn.text();Str.get_strings([{key:"confirm_bulk_grade",component:"local_aigrade"},{key:"grading_in_progress",component:"local_aigrade"},{key:"success_graded_count",component:"local_aigrade"},{key:"error_with_message",component:"local_aigrade"},{key:"error_unknown",component:"local_aigrade"},{key:"error_server_communication",component:"local_aigrade"}]).done((function(strings){confirm(strings[0])&&(btn.prop("disabled",!0).text(strings[1]),Ajax.call([{methodname:"local_aigrade_grade_bulk",args:{cmid:cmid}}])[0].done((function(response){if(response.success)Notification.addNotification({message:strings[2].replace("{$a}",response.count),type:"success"}),window.location.reload();else{var errorMsg=response.error||strings[4];Notification.addNotification({message:strings[3].replace("{$a}",errorMsg),type:"error"}),btn.prop("disabled",!1).text(originalText)}})).fail((function(error){var errorMsg=error.message||strings[4];Notification.addNotification({message:strings[5].replace("{$a}",errorMsg),type:"error"}),btn.prop("disabled",!1).text(originalText)})))})).fail((function(){confirm("Grade all ungraded submissions with AI? This may take a few moments.")&&(btn.prop("disabled",!0).text("Grading all submissions..."),Ajax.call([{methodname:"local_aigrade_grade_bulk",args:{cmid:cmid}}])[0].done((function(response){response.success?(alert("Successfully graded "+response.count+" submission(s)."),window.location.reload()):(alert("Error: "+(response.error||"Unknown error occurred")),btn.prop("disabled",!1).text(originalText))})).fail((function(error){alert("Error communicating with server: "+(error.message||"Unknown error")),btn.prop("disabled",!1).text(originalText)})))}))})),inserted=!1;return $(".tertiary-navigation").length&&($(".tertiary-navigation").first().prepend($("<div>").css("display","inline-block").append(button)),inserted=!0),!inserted&&$("#page-header").length&&($("#page-header").first().after($("<div>").addClass("alert alert-info").css("margin","15px").append(button)),inserted=!0),!inserted&&$("#page-content").length&&($("#page-content").prepend($("<div>").addClass("alert alert-info").css("margin","15px").append(button)),inserted=!0),inserted};$(document).ready((function(){if(!insertButton())var checkCount=0,insertInterval=setInterval((function(){checkCount++,(insertButton()||checkCount>=10)&&clearInterval(insertInterval)}),500)})),$(window).on("load",(function(){insertButton()}))}}}));

//# sourceMappingURL=grade_bulk.min.js.map